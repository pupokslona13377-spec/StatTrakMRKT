<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Massage Ultra MiniApp</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
<style>
body {
    background: linear-gradient(135deg, #1e293b, #0f172a);
    color: #f9fafb;
    font-family: 'Inter', sans-serif;
}
.master-card {
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: pointer;
}
.master-card:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 25px rgba(0,0,0,0.6);
}
button {
    transition: all 0.2s;
}
button:hover {
    background-color: #4b5563;
}
.ripple {
    position: relative;
    overflow: hidden;
}
.ripple:after {
    content: '';
    position: absolute;
    border-radius: 50%;
    width: 100px;
    height: 100px;
    background: rgba(255,255,255,0.3);
    transform: scale(0);
    opacity: 0;
    pointer-events: none;
    animation: ripple 0.6s linear;
}
@keyframes ripple {
    to { transform: scale(4); opacity: 0; }
}
.balance {
    font-size: 2rem;
    font-weight: bold;
    transition: all 0.3s ease;
}
.modal-bg {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6); display: none;
    justify-content: center; align-items: center; z-index: 50;
}
.modal {
    background: #1f2937; padding: 2rem;
    border-radius: 2rem; max-width: 500px;
    width: 90%; box-shadow: 0 0 20px rgba(0,0,0,0.7);
}
.slot {
    cursor: pointer; padding:0.5rem 1rem; border-radius:1rem;
    margin:0.25rem; background:#374151; display:inline-block;
    transition: transform 0.2s, background 0.2s;
}
.slot:hover { transform: scale(1.1); background:#4b5563; }
</style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-6">

<h1 class="text-4xl font-bold mb-8 animate__animated animate__fadeInDown">üíÜ‚Äç‚ôÄÔ∏è Massage Ultra Mini App</h1>

<!-- –ú–∞—Å—Ç–µ—Ä–∞ -->
<div class="w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10" id="masters">
<!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –º–∞—Å—Ç–µ—Ä–æ–≤ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è JS -->
</div>

<!-- –ë–∞–ª–∞–Ω—Å -->
<div class="w-full max-w-3xl bg-gray-800 p-6 rounded-3xl shadow-lg mb-10 animate__animated animate__fadeInUp">
<h2 class="text-2xl font-semibold mb-4">üí∞ –ë–∞–ª–∞–Ω—Å</h2>
<p id="balance" class="balance mb-4">0 ‚ÇΩ</p>
<button id="topup-btn" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-semibold text-white ripple">–ü–æ–ø–æ–ª–Ω–∏—Ç—å 10000 ‚ÇΩ (—Ç–µ—Å—Ç)</button>
</div>

<!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã -->
<div class="w-full max-w-4xl bg-gray-800 p-6 rounded-3xl shadow-lg animate__animated animate__fadeInUp mb-10">
<h2 class="text-2xl font-semibold mb-4">üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
<ul id="active-orders" class="list-disc pl-6 mb-6"></ul>
<h2 class="text-2xl font-semibold mb-4">üï∞ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
<ul id="history-orders" class="list-disc pl-6"></ul>
</div>

<!-- –ú–æ–¥–∞–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div class="modal-bg" id="booking-modal">
<div class="modal animate__animated animate__zoomIn">
<h2 class="text-xl font-bold mb-4" id="modal-master-name">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h2>
<div id="slots-container" class="flex flex-wrap"></div>
<button id="close-modal" class="mt-4 px-4 py-2 bg-gray-700 rounded-xl">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>

<script>
const userId = 'demo-user';
const mastersContainer = document.getElementById('masters');
const balanceEl = document.getElementById('balance');
const topupBtn = document.getElementById('topup-btn');
const activeOrdersEl = document.getElementById('active-orders');
const historyOrdersEl = document.getElementById('history-orders');
const bookingModal = document.getElementById('booking-modal');
const slotsContainer = document.getElementById('slots-container');
const modalMasterName = document.getElementById('modal-master-name');
const closeModalBtn = document.getElementById('close-modal');

async function fetchMasters() {
    const res = await fetch('/api/masters');
    return res.json();
}

async function fetchUser() {
    const res = await fetch(`/api/user/${userId}`);
    return res.json();
}

async function topUp() {
    navigator.vibrate(100);
    await fetch(`/api/user/${userId}/topup`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({amount:10000})
    });
    updateUser();
}

async function bookMaster(master) {
    navigator.vibrate(150);
    modalMasterName.textContent = `–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –¥–ª—è ${master.name}`;
    slotsContainer.innerHTML = '';
    const now = new Date();
    for(let i=9;i<=20;i++){
        const slot = document.createElement('div');
        slot.className = 'slot';
        const slotDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), i,0,0);
        slot.textContent = slotDate.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
        slot.onclick = async ()=>{
            await fetch(`/api/user/${userId}/book`,{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({masterName: master.name})
            });
            bookingModal.style.display = 'none';
            updateUser();
            alert(`–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ ${master.name} –Ω–∞ ${slotDate.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}`);
        }
        slotsContainer.appendChild(slot);
    }
    bookingModal.style.display = 'flex';
}

closeModalBtn.onclick = ()=>{bookingModal.style.display='none';}

function renderMasters(masters){
    mastersContainer.innerHTML = '';
    masters.forEach(master=>{
        const card = document.createElement('div');
        card.className = 'master-card bg-gray-700 p-4 rounded-3xl flex flex-col items-center shadow-lg animate__animated animate__fadeInUp';
        card.innerHTML = `
        <img src='https://via.placeholder.com/180' alt='${master.name}' class='rounded-full mb-3 shadow-md'>
        <h3 class='text-xl font-bold mb-2'>${master.name}</h3>
        <p class='mb-2 text-yellow-400'>‚≠ê ${master.rating}</p>
        <p class='mb-3 text-gray-300'>–¶–µ–Ω–∞: ${master.price} ‚ÇΩ/—á–∞—Å</p>
        <button class='px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-semibold text-white ripple' onclick='bookMaster(${JSON.stringify(master)})'>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        `;
        mastersContainer.appendChild(card);
    });
}

function renderOrders(user){
    balanceEl.textContent = `${user.balance} ‚ÇΩ`;
    activeOrdersEl.innerHTML='';
    historyOrdersEl.innerHTML='';
    user.activeOrders.forEach(order=>{
        const li=document.createElement('li');
        li.className='animate__animated animate__fadeIn';
        li.textContent=`${order.master} ‚Äî ${order.price} ‚ÇΩ ‚Äî ${new Date(order.date).toLocaleString()}`;
        activeOrdersEl.appendChild(li);
    });
    user.historyOrders.forEach(order=>{
        const li=document.createElement('li');
        li.className='animate__animated animate__fadeIn';
        li.textContent=`${order.master} ‚Äî ${order.price} ‚ÇΩ ‚Äî ${new Date(order.date).toLocaleString()}`;
        historyOrdersEl.appendChild(li);
    });
}

async function updateUser(){
    const user = await fetchUser();
    renderOrders(user);
}

topupBtn.addEventListener('click',topUp);
fetchMasters().then(renderMasters);
updateUser();
</script>
<!-- –ß–∞—Å—Ç—å 2/3 -->

<!-- Admin Panel (Demo) -->
<div class="w-full max-w-4xl bg-gray-900 p-6 rounded-3xl shadow-lg mb-10 animate__animated animate__fadeInUp">
  <h2 class="text-2xl font-semibold mb-4">üõ† Admin Panel (Demo)</h2>
  <p class="mb-4 text-gray-300">–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∑–∞–∫–∞–∑—ã (demo)</p>
  <div id="admin-users" class="mb-6"></div>
  <div id="admin-orders"></div>
</div>

<script>
// Demo Admin data
async function fetchAdminData() {
    const res = await fetch(`/api/user/${userId}`);
    const user = await res.json();
    const adminUsersDiv = document.getElementById('admin-users');
    adminUsersDiv.innerHTML = `<p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userId}, –ë–∞–ª–∞–Ω—Å: ${user.balance} ‚ÇΩ</p>`;
    const adminOrdersDiv = document.getElementById('admin-orders');
    let html = '<h3 class="text-xl font-semibold mb-2">–í—Å–µ –∑–∞–∫–∞–∑—ã:</h3><ul class="list-disc pl-6">';
    user.activeOrders.forEach(order=>{
        html+=`<li>${order.master} ‚Äî ${order.price} ‚ÇΩ ‚Äî ${new Date(order.date).toLocaleString()}</li>`;
    });
    html+='</ul>';
    adminOrdersDiv.innerHTML=html;
}

fetchAdminData();
</script>

<!-- Rating System -->
<div class="w-full max-w-6xl mb-10">
<h2 class="text-2xl font-semibold mb-4 animate__animated animate__fadeInUp">üåü –†–µ–π—Ç–∏–Ω–≥ –º–∞—Å—Ç–µ—Ä–æ–≤</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rating-masters">
<!-- —Ä–µ–π—Ç–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ JS -->
</div>
</div>

<script>
function renderRatings(masters){
    const container = document.getElementById('rating-masters');
    container.innerHTML='';
    masters.forEach(master=>{
        const card=document.createElement('div');
        card.className='bg-gray-700 p-4 rounded-3xl shadow-lg animate__animated animate__fadeInUp';
        card.innerHTML=`
        <h3 class="text-xl font-bold mb-2">${master.name}</h3>
        <p class="mb-2 text-gray-300">–¶–µ–Ω–∞: ${master.price} ‚ÇΩ/—á–∞—Å</p>
        <p class="mb-2 text-yellow-400">–†–µ–π—Ç–∏–Ω–≥: ${master.rating} ‚≠ê</p>
        <div class="flex space-x-1">
            ${Array(Math.floor(master.rating)).fill('‚≠ê').join('')}
            ${master.rating%1? '‚ú∞':''}
        </div>
        `;
        container.appendChild(card);
    });
}

fetchMasters().then(renderRatings);
</script>

<!-- Advanced Animations & Micro Vibe -->
<script>
// Card hover vibration for mobile
document.querySelectorAll('.master-card').forEach(card=>{
    card.addEventListener('touchstart', ()=>{navigator.vibrate(20);});
});

// Animate balance increment
const originalBalance = parseInt(balanceEl.textContent);
function animateBalance(oldVal,newVal){
    let current = oldVal;
    const interval = setInterval(()=>{
        if(current>=newVal){clearInterval(interval); balanceEl.textContent=newVal+' ‚ÇΩ'; return;}
        current+=Math.ceil((newVal-oldVal)/20);
        balanceEl.textContent=current+' ‚ÇΩ';
    },25);
}
</script>

<!-- Booking Flow Enhancements -->
<script>
function enhanceBookingFlow(){
    const slots = document.querySelectorAll('.slot');
    slots.forEach(slot=>{
        slot.addEventListener('mouseenter',()=>slot.style.transform='scale(1.15)');
        slot.addEventListener('mouseleave',()=>slot.style.transform='scale(1)');
    });
}
setInterval(enhanceBookingFlow,1000);
</script>

<!-- Premium UI gradients & hover effects -->
<style>
#masters button {
    background: linear-gradient(90deg,#a855f7,#ec4899);
    box-shadow: 0 4px 15px rgba(236,72,153,0.4);
}
#masters button:hover {
    box-shadow: 0 6px 20px rgba(236,72,153,0.6);
}
</style>
<!-- –ß–∞—Å—Ç—å 3/3 -->

<!-- Full Mini Calendar -->
<div class="w-full max-w-4xl bg-gray-800 p-6 rounded-3xl shadow-lg mb-10 animate__animated animate__fadeInUp">
  <h2 class="text-2xl font-semibold mb-4">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h2>
  <div id="mini-calendar" class="grid grid-cols-7 gap-2 text-center"></div>
</div>

<script>
// Mini Calendar setup
function renderCalendar(){
    const container = document.getElementById('mini-calendar');
    container.innerHTML='';
    const today = new Date();
    for(let i=0;i<14;i++){ // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 2 –Ω–µ–¥–µ–ª–∏
        const date = new Date(today);
        date.setDate(today.getDate()+i);
        const dayDiv = document.createElement('div');
        dayDiv.className='slot bg-gray-700 hover:bg-gray-600 rounded-lg p-2';
        dayDiv.textContent = date.toLocaleDateString('ru-RU',{day:'numeric',month:'short'});
        dayDiv.onclick = ()=>alert('–í—ã –≤—ã–±—Ä–∞–ª–∏ '+date.toLocaleDateString('ru-RU'));
        container.appendChild(dayDiv);
    }
}
renderCalendar();
</script>

<!-- Booking Confirmation Modal -->
<div class="modal-bg" id="confirm-modal">
<div class="modal animate__animated animate__fadeInUp">
<h2 class="text-xl font-bold mb-4">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –±—Ä–æ–Ω—å</h2>
<p id="confirm-text" class="mb-4"></p>
<button id="confirm-ok" class="px-4 py-2 bg-green-600 rounded-xl mr-2">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
<button id="confirm-cancel" class="px-4 py-2 bg-red-600 rounded-xl">–û—Ç–º–µ–Ω–∞</button>
</div>
</div>

<script>
const confirmModal = document.getElementById('confirm-modal');
const confirmText = document.getElementById('confirm-text');
const confirmOk = document.getElementById('confirm-ok');
const confirmCancel = document.getElementById('confirm-cancel');

function showConfirm(masterName, slot){
    confirmText.textContent=`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å ${masterName} –Ω–∞ ${slot}?`;
    confirmModal.style.display='flex';
    confirmOk.onclick = async ()=>{
        await fetch(`/api/user/${userId}/book`,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({masterName})
        });
        confirmModal.style.display='none';
        updateUser();
        alert(`–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ ${masterName} –Ω–∞ ${slot}`);
    };
    confirmCancel.onclick = ()=>{confirmModal.style.display='none';};
}
</script>

<!-- Animate Orders -->
<script>
function animateOrders(){
    document.querySelectorAll('#active-orders li, #history-orders li').forEach(li=>{
        li.classList.add('animate__animated','animate__fadeInUp');
    });
}
setInterval(animateOrders,2000);
</script>

<!-- Balance Pulse Animation -->
<script>
function pulseBalance(){
    balanceEl.classList.add('animate__animated','animate__pulse');
    setTimeout(()=>balanceEl.classList.remove('animate__animated','animate__pulse'),700);
}
setInterval(pulseBalance,5000);
</script>

<!-- Admin Panel Enhancements -->
<script>
// Admin add/remove masters demo
function adminEnhancements(){
    const ratingMasters = document.getElementById('rating-masters');
    const card = document.createElement('div');
    card.className='bg-gray-700 p-4 rounded-3xl shadow-lg animate__animated animate__fadeInUp';
    card.innerHTML=`<h3 class="text-xl font-bold mb-2">New Master</h3><p class="mb-2 text-gray-300">–¶–µ–Ω–∞: 2000 ‚ÇΩ/—á–∞—Å</p>`;
    ratingMasters.appendChild(card);
}
setInterval(adminEnhancements,15000); // demo adding new master
</script>

<!-- Advanced Visual Effects -->
<style>
#mini-calendar .slot {
    transition: transform 0.3s, background 0.3s;
}
#mini-calendar .slot:hover {
    transform: scale(1.15);
    background: #4b5563;
}
</style>

<!-- Footer -->
<footer class="w-full mt-10 text-center text-gray-400">
<p>&copy; 2026 Massage Ultra MiniApp | Demo Version</p>
</footer>

</body>
</html>
